<!DOCTYPE html>
<html>

<head>
    <title>Natdanai.Portfolio</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.17"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>


    <script>
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020);

        const clickableObjects = [];
        let targetPos = new THREE.Vector3();
        let targetLookAt = new THREE.Vector3();

        // Camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(100, 300, 0);
        targetPos.set(40, 135, 40);         // ตำแหน่งกล้องที่อยากไป
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target.set(-180, 135, 40);
        targetLookAt.set(-180, 135, 40);
        controls.enableDamping = true;
        controls.update();

        // Lights
        const ambient = new THREE.AmbientLight(0x404040, 1);
        scene.add(ambient);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
        dirLight.position.set(5, 5, 5);
        dirLight.castShadow = true;
        scene.add(dirLight);

        const spotLight2 = new THREE.SpotLight(0xffffff, 0.5);
        spotLight2.position.set(30, 280, 180);
        spotLight2.rotation.y = Math.PI / 5;
        spotLight2.castShadow = true;
        spotLight2.penumbra = 0.3;
        spotLight2.decay = 2;
        spotLight2.distance = 500;

        scene.add(spotLight2);

        const spotLight = new THREE.SpotLight(0xffffff, 1);
        spotLight.position.set(-25, 160, 35);
        spotLight.castShadow = true;
        spotLight.penumbra = 0.3;
        spotLight.decay = 2;
        spotLight.distance = 500;
        scene.add(spotLight);

        //ปรับตามขนาดจอ
        function setPointer(e) {
            const r = renderer.domElement.getBoundingClientRect();
            const x = (e.clientX ?? e.touches[0].clientX) - r.left;
            const y = (e.clientY ?? e.touches[0].clientY) - r.top;
            pointer.x = (x / r.width) * 2 - 1; //อ่านความกว้างหน้าจอ
            pointer.y = -(y / r.height) * 2 + 1;
        }

        addEventListener('resize', () => {
            camera.aspect = innerWidth / innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(innerWidth, innerHeight);
        });

        //dust2
        const mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("dust2.mtl", function (materials) {
            materials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("dust2.obj", function (object) {
                object.scale.set(100, 100, 100);
                object.position.set(0, 120, 0);

                object.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });

                scene.add(object);
            });
        });

        //ชื่อ
        let nameinfo;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("Name.mtl", function (nameinfoMaterials) {
            nameinfoMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(nameinfoMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("Name.obj", function (object_nameinfo) {
                nameinfo = object_nameinfo;
                nameinfo.scale.set(6, 6, 6);
                nameinfo.position.set(40, 210, 140);
                nameinfo.rotation.y = Math.PI / 5;

                nameinfo.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;   // ให้เหรียญสร้างเงา
                        child.receiveShadow = false; // ปกติไม่ต้องรับเงาตัวเอง
                    }
                });
                scene.add(nameinfo);
            });
        });

        //medal
        let medal;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("medal.mtl", function (medalMaterials) {
            medalMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(medalMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("medal.obj", function (object_medal) {
                medal = object_medal;  // เก็บไว้ในตัวแปรด้านนอก
                medal.scale.set(20, 20, 20);
                medal.position.set(-25, 110, 30);
                medal.rotation.y = Math.PI / 2;

                medal.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;   // ให้เหรียญสร้างเงา
                        child.receiveShadow = false; // ปกติไม่ต้องรับเงาตัวเอง
                    }
                });
                scene.add(medal);
                clickableObjects.push(medal);
            });
        });

        //สุดหล่อที่เธอเหลียว
        const textureLoader = new THREE.TextureLoader();
        const handsomeTexture = textureLoader.load('https://lnwn4tt.github.io/Com-graph_HW3/handsomeboy.jpg');

        const geo = new THREE.BoxGeometry(30, 40, 0.1);
        const mat = new THREE.MeshBasicMaterial({ map: handsomeTexture });
        const cube = new THREE.Mesh(geo, mat);
        cube.scale.set(2, 2, 2);
        cube.position.set(0, 250, 200);
        cube.rotation.y = Math.PI / 5;
        scene.add(cube);

        //about me
        let aboutMe;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("aboutMe.mtl", function (aboutmeMaterials) {
            aboutmeMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(aboutmeMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("aboutMe.obj", function (object_aboutme) {
                aboutMe = object_aboutme;  // เก็บไว้ในตัวแปรด้านนอก
                aboutMe.scale.set(10, 10, 10);
                aboutMe.position.set(-25, 120, 60);
                aboutMe.rotation.y = Math.PI / 2;

                aboutMe.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                scene.add(aboutMe);
                clickableObjects.push(aboutMe);
            });
        });

        //projects
        let projects;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("projects.mtl", function (projectsMaterials) {
            projectsMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(projectsMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("projects.obj", function (object_projects) {
                projects = object_projects;  // เก็บไว้ในตัวแปรด้านนอก
                projects.scale.set(10, 10, 10);
                projects.position.set(-25, 135, 70);
                projects.rotation.y = Math.PI / 2;

                projects.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                scene.add(projects);
                clickableObjects.push(projects);
            });
        });

        //backbot
        let backbot;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("Backbot.mtl", function (backbotMaterials) {
            backbotMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(backbotMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("Backbot.obj", function (object_backbot) {
                backbot = object_backbot;  // เก็บไว้ในตัวแปรด้านนอก
                backbot.scale.set(10, 10, 10);
                backbot.position.set(0, 200, 200);
                backbot.rotation.y = Math.PI / 5;

                backbot.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                scene.add(backbot);
                clickableObjects.push(backbot);
            });
        });

        const Group1 = new THREE.Group();
        scene.add(Group1);

        //backbot PROJECFTS*
        let backProj;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("Backbot.mtl", function (backProjMaterials) {
            backProjMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(backProjMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("Backbot.obj", function (object_backProj) {
                backProj = object_backProj;  // เก็บไว้ในตัวแปรด้านนอก
                backProj.scale.set(5, 5, 5);
                backProj.position.set(-20, 0, 0);
                //backProj.rotation.y = Math.PI / 3;

                backProj.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                //scene.add(backProj);
                Group1.add(backProj);
                clickableObjects.push(backProj);
            });
        });

        //Nextbot PROJECTS*
        let nextProj;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("nextbot.mtl", function (nextProjMaterials) {
            nextProjMaterials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(nextProjMaterials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("nextbot.obj", function (object_nextProj) {
                nextProj = object_nextProj;  // เก็บไว้ในตัวแปรด้านนอก
                nextProj.scale.set(5, 5, 5);
                nextProj.position.set(0, 0, 0);
                //nextProj.rotation.y = Math.PI / 3;

                nextProj.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                //scene.add(nextProj);
                Group1.add(nextProj);
                clickableObjects.push(nextProj);
            });
        });

        //backbot PROJECTS2**
        let backProj2;
        mtlLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
        mtlLoader.load("Backbot.mtl", function (backProj2Materials) {
            backProj2Materials.preload();

            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(backProj2Materials);
            objLoader.setPath("https://lnwn4tt.github.io/Com-graph_HW3/");
            objLoader.load("Backbot.obj", function (object_backProj2) {
                backProj2 = object_backProj2;  // เก็บไว้ในตัวแปรด้านนอก
                backProj2.scale.set(5, 5, 5);
                backProj2.position.set(-40, 165, -470);
                backProj2.rotation.y = Math.PI / 3;

                backProj2.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });

                scene.add(backProj2);
                clickableObjects.push(backProj2);
            });
        });

        Group1.position.set(0, 120, -240);
        Group1.rotation.y = Math.PI / 4;

        //click
        const clicksound = new Audio("https://lnwn4tt.github.io/Com-graph_HW3/minecraft-click-cropped.mp3");
        clicksound.volume = 0.3;

        let countMedal = 0;

        window.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(clickableObjects, true);
            if (intersects.length > 0) {
                const clickedObj = intersects[0].object; // mesh ที่ถูกคลิก
                clicksound.currentTime = 0; // รีเซ็ตให้เล่นตั้งแต่ต้นทุกครั้ง
                clicksound.play();

                // เปลี่ยนสี object ที่โดน
                clickedObj.traverse((child) => {
                    if (child.isMesh && !medal.children.includes(child)) {
                        child.material.color.set(0x00ff00);
                    }
                });

                if (intersects[0].object.parent === aboutMe) {
                    //controls.enabled = false;
                    targetPos.set(80, 245, 240);         // ตำแหน่งกล้องที่อยากไป
                    targetLookAt.set(-120, 240, -30);    // ตำแหน่งที่อยากให้กล้องมอง
                    controls.update();

                } else if (intersects[0].object.parent === projects) {
                    controls.enabled = false;
                    targetPos.set(40, 135, -180);
                    targetLookAt.set(30, 135, -190);
                    controls.update();

                } else if (intersects[0].object.parent === backbot) {
                    controls.enabled = true;
                    targetPos.set(40, 135, 40);         // ตำแหน่งกล้องที่อยากไป
                    targetLookAt.set(-180, 135, 40);
                    controls.update();

                } else if (intersects[0].object.parent === medal) {
                    controls.enabled = false;

                    if (countMedal == 0) {
                        targetPos.set(25, 135, 20);
                        targetLookAt.set(-180, 135, 40);
                        controls.update();
                        countMedal = 1;
                    } else if (countMedal == 1) {
                        targetPos.set(40, 135, 40);         // ตำแหน่งกล้องที่อยากไป
                        targetLookAt.set(-180, 135, 40);
                        controls.update();
                        countMedal = 0;
                    }

                } else if (intersects[0].object.parent === backProj) {
                    controls.enabled = true;
                    targetPos.set(40, 135, 40);
                    targetLookAt.set(-180, 135, 40);
                    controls.update();

                } else if (intersects[0].object.parent === nextProj) {
                    controls.enabled = true;
                    targetPos.set(30, 165, -470);         
                    targetLookAt.set(20, 165, -480);
                    controls.update();
                } else if (intersects[0].object.parent === backProj2) {
                    controls.enabled = false;
                    targetPos.set(40, 135, -180);
                    targetLookAt.set(30, 135, -190);
                    controls.update();
                }
            }
        });

        //เปลี่ยนสีเมื่อโดน object
        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        });

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let hovered = null; // เก็บ object ที่โดน hover อยู่
        let originalColor = null; // เก็บสีเดิม

        let hoveredObjects = { aboutMe: null, projects: null, backbot: null, backProj: null, nextProj: null, backProj2: null };
        let originalColors = { aboutMe: null, projects: null, backbot: null, backProj: null, nextProj: null, backProj2: null };

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);

            handleHover(aboutMe, "aboutMe");
            handleHover(projects, "projects");
            handleHover(backbot, "backbot");
            handleHover(backProj, "backProj");
            handleHover(nextProj, "nextProj");
            handleHover(backProj2, "backProj2");
        }

        function handleHover(obj, key) {
            if (!obj) return;

            const intersects = raycaster.intersectObject(obj, true);
            if (intersects.length > 0) {
                if (hoveredObjects[key] !== obj) {
                    hoveredObjects[key] = obj;
                    obj.traverse(child => {
                        if (child.isMesh) {
                            if (!originalColors[key]) {
                                originalColors[key] = child.material.color.clone();
                            }
                            child.material.color.set(0xff0000);
                        }
                    });
                }
            } else {
                if (hoveredObjects[key]) {
                    hoveredObjects[key].traverse(child => {
                        if (child.isMesh && originalColors[key]) {
                            child.material.color.copy(originalColors[key]);
                        }
                    });
                    hoveredObjects[key] = null;
                }
            }
        }


        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        //ฉาก
        new THREE.RGBELoader()
            .load('https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/minedump_flats_1k.hdr', function (hdrEquirect) {
                const envMap = pmremGenerator.fromEquirectangular(hdrEquirect).texture;
                scene.background = envMap;
                scene.environment = envMap;

                hdrEquirect.dispose();
                pmremGenerator.dispose();
            });

        function lerp(a, b, tlerp) {
            return a + (b - a) * t;   // t ใน [0..1]
        }

        const tlerp = 0.0;

        const speed = 2; // ความเร็ว
        const distance = 75; // ระยะที่แสงจะเคลื่อนที่ไป
        let t = 0.0;
        function animate() {
            controls.update();

            //tlerp +=0.02;
            t += 0.001;
            requestAnimationFrame(animate);
            checkIntersection();
            if (medal) {
                medal.rotation.y += 0.01;
            }
            spotLight2.position.x = Math.sin(t * speed) * distance;

            camera.position.lerp(targetPos, 0.02);
            controls.target.lerp(targetLookAt, 0.02);
            //controls.target.lerp(clickableObjects, 0.02);
            renderer.render(scene, camera);
        }
        animate();

    </script>
</body>


</html>